---
title: "Functions in Action to Help You Write Your Report"
author: Emily Markowitz (Emily.Markowitz AT NOAA.gov / EmilyMarkowitz-NOAA)
date: "`r format(Sys.Date(), format='%B %d %Y') `"
output: 
  html_document:
    standalone: true
    smart: true
    normalize: true
    toc: true
    highlight: tango
    self-contained: true
    theme: cerulean
  pdf_document:
    toc: true
    highlight: tango
csl: "../inst/cit/apa.csl"
bibliography: "../inst/rmd/bib_example.bib"
vignette: >
  %\VignetteIndexEntry{C_functions-to-help-write-report}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, setup, include = FALSE}
knitr::opts_chunk$set(message = FALSE, echo = TRUE, warning = FALSE, 
  collapse = TRUE,
  comment = "#>"
)

TF<-FALSE

PKG <- c(# devtools::install_github("emilymarkowitz-NOAA/NMFSReports", force = TRUE)
         "NMFSReports",
         
         # Data Managment
         "tidyverse",
         "here",
         
         # Visuals
         "png",
         "cowplot",
         "nmfspalette"
)

for (p in PKG) {
  if(!require(p,character.only = TRUE)) {  
    install.packages(p, repos = "http://cran.us.r-project.org")
    require(p,character.only = TRUE)}
}
```


## From run file: 
```{r a}
cnt_chapt <- "000" # Keep everything in a proper order
plot_list <- c() # This will help us by saving R-ready plots so we can easily go back and edit them if necessary. 
table_list <- c() # This will help us by saving R-ready tables  so we can easily go back and edit them if necessary. 
cnt_figures <- 0 # This will autoname your figures with consecutive numbers (e.g., Figure 1.)
cnt_tables <- 0 # This will autoname your tables with consecutive numbers (e.g., Table 1.)
cnt_equ <- 0

cnt_chapt_content<-0
filename0<-"example"
indesign_flowin<-FALSE

# example data from what would be in the data.R file
dat <- data.frame(x = rnorm(n = 10), 
                y = rnorm(n = 10), 
                col = rep_len(x = c("a", "b"), length.out = 5))
Footnotes.list<-list("ExOfStandardFt" = "Wow, this project is so cool!")

```

# Example of how to use this R Markdown document

Here is the report content!

## Citations

My example dataset has `r xunits(nrow(dat))` rows in it and `r xunits(ncol(dat))` columns in it.`r paste0("^[", Footnotes.list$ExOfStandardFt,"]") ` That is `r pchange(start = dat$x[1], end = dat$x[10])`^[Here's another, free-written footnote!]. This work has nothing to do with [@RN170], but I'll cite it here anyway. I am sure that @RN621 would like to have something to say about that!

Note that references will appear at the bottom of this document (and any document that you put references in) but when you combine this document with all of the other documents that you create, it will shift to the bottom of the report.

## Equations

Here is some equation you'll need to have in this report, of which produces the variable $X$. 

```{r Eq1}
cnt_equ<-auto_counter(cnt_equ)
```

Eq. `r cnt_equ`

$$X = Y + Z$$

## Example Figure (Plot)

```{r G1a}
# Edit This:
header <- "Here is a figure!"
footnote<-c("A footnote for this figure!", "A second footnote for this figure!")

# Select data and make plot
plot0<- dat %>%
  ggplot(aes(x = x, y = y, colour = as.factor(col))) + # create plot
  geom_point() +
  nmfspalette::scale_color_nmfs(palette = "coral") # Use NMFS Color Pallet
```


```{r G1b}
# Don't Edit This:
cnt_chapt_content<-NMFSReports::auto_counter(cnt_chapt_content)
cnt_figures<-cnt_figures + 1

# Systematically save your plot with this simple function
plot_list<-save_graphs(plot0 = plot0, 
                      plot_list = plot_list, 
                      header = header,
                      footnote = footnote,
                      filename0 = filename0, 
                      cnt_chapt_content = cnt_chapt_content, 
                      cnt = cnt_figures, 
                      # path = dir_out_figures, 
                      width = 6, # you can change this if you need to...
                      height = 6) # you can change this if you need to...

```


```{r G1c, fig.cap=ifelse(indesign_flowin %in% TRUE, "", plot_list[[length(plot_list)]]$caption)}
# Print or Don't Print Plot in Text
# You don't want to print this in the document if this text will be flowed into InDesign. 
# However, sometimes its nice to see everything all together, so this variable is 
# something you might like to toggle on and off. 
# Hense, FALSE = print here, TRUE = don't print here, just make the .pdf (coded above)
if (indesign_flowin %in% FALSE) { 
  plot0 # print plot in text
} else if (indesign_flowin %in% TRUE){ # for reports that need to be flowed into InDesign 
  rmarkdown::render(TableFigureHeader, 
                    quiet = TRUE,
                  output_dir = dir_chapters, 
                  output_file = paste0(filename00,cnt_chapt_content,"_Title.docx"))
}
```

## Example Figure (Refernce Image)

```{r G2a}
# Edit This:
header <- "Here is a figure!"
footnote<-c("A footnote for this figure!")

# Select data and make plot
plot0 <- 
  cowplot::ggdraw() +
  cowplot::draw_image(readPNG(here::here("inst", "img", "noaa-gray.png"))) 
```


```{r G2b}
# Don't Edit This:
cnt_chapt_content<-auto_counter(cnt_chapt_content)
cnt_figures<-cnt_figures+1

# Systematically save your plot with this simple function
plot_list<-save_graphs(plot0 = plot0, 
                      plot_list = plot_list, 
                      header = header,
                      footnote = footnote,
                      filename0 = filename0, 
                      cnt_chapt_content = cnt_chapt_content, 
                      cnt = cnt_figures, 
                      # path = dir_out_figures, 
                      width = 1, # you can change this if you need to...
                      height = 1,  # you can change this if you need to...
                      filename_desc = "noaalogo")

```


```{r G2c, fig.cap=ifelse(indesign_flowin %in% TRUE, "", plot_list[[length(plot_list)]]$caption)}
# Print or Don't Print Plot in Text
# You don't want to print this in the document if this text will be flowed into InDesign. 
# However, sometimes its nice to see everything all together, so this variable is 
# something you might like to toggle on and off. 
# Hense, FALSE = print here, TRUE = don't print here, just make the .pdf (coded above)
if (indesign_flowin %in% FALSE) { 
  plot0 # print plot in text
} else if (indesign_flowin %in% TRUE){ # for reports that need to be flowed into InDesign 
  rmarkdown::render(TableFigureHeader, 
                    quiet = TRUE,
                  output_dir = dir_chapters, 
                  output_file = paste0(filename00,cnt_chapt_content,"_Title.docx"))
}
```

## Example Table (Basic)

```{r T1a}
# Edit This:
header <- "Here is a table!"
footnote<-"A footnote for this table!"

# Select data and make plot
table_raw<-data.frame(col = LETTERS[1:10], 
                      x = rnorm(n = 10), 
                y = rnorm(n = 10)) 
table_print <- table_raw
table_print[,c("x", "y")] <- NMFSReports::mod_number(table_print[,c("x", "y")], 
                                                     divideby = 1, 
                                                     comma_seperator = TRUE, 
                                                     digits = 2)

```


```{r T1b}
# Don't Edit This:
cnt_chapt_content<-auto_counter(cnt_chapt_content)
cnt_tables<-cnt_tables+1

# Systematically save your plot with this simple function
table_list<-save_tables(table_raw = table_raw, 
                        table_print = table_print, 
                        table_list = table_list, 
                        header = header,
                        footnote = footnote,
                        filename0 = filename0, 
                        cnt_chapt_content = cnt_chapt_content, 
                        cnt = cnt_tables#, 
                        # path = dir_out_tables
                        )
```


```{r T1c, fig.cap=ifelse(indesign_flowin %in% TRUE, "", table_list[[length(table_list)]]$caption)}

# Print or Don't Print Table in Text
# You don't want to print this in the document if this text will be flowed into InDesign. 
# However, sometimes its nice to see everything all together, so this variable is something you might like to toggle on and off. Hense, FALSE = print here, TRUE = don't print here, just make the .pdf (coded above)
if (indesign_flowin %in% FALSE) {
  table_print %>%
          format_cells(rows = 0, # make column names
                       cols = 1:ncol(table_print), # for all columns
                       fonttype = "bold") %>% # bold
          knitr::kable(row.names = FALSE, booktabs = TRUE) #print table in text
}
```

## Example Table (With Footnotes)

```{r T2a}
# Edit This:
header <- "Here is a table!"
footnote<-"A footnote for this table!"

# Select data
table_raw<-data.frame(col = LETTERS[1:10], 
                      x = rnorm(n = 10), 
                y = rnorm(n = 10), 
                footnotes = NA) 

table_raw$footnotes[3]<-"Example footnote in a table 1."
table_raw$footnotes[4]<-"Example footnote in a table 2.&&&Example footnote in a table 3."
table_print <- table_raw
table_print[,c("x", "y")] <- NMFSReports::mod_number(table_print[,c("x", "y")], 
                                                     divideby = 1, 
                                                     comma_seperator = TRUE, 
                                                     digits = 2)

# example of how to add footnotes from a column of footnotes
# here, we'll add footnotes from the "footnotes" column to the content in the first column, where necessary
table_print <- add_table_footnotes(tab = table_print, 
                             from_col = "footnotes", # either use the name of the column
                             to_col = 1) # or the number of that column in that table

# here, I'll add a specific footnote to a specific place in the table
table_print <- add_table_footnotes(tab = table_print, 
                                   footnote = "Example footnote in a table 4.", 
                             to_row = 2, 
                             to_col = 2)

table_print <- add_table_footnotes(tab = table_print, 
                                   footnote = c("Example footnote in a table 5.", 
                                                "Example footnote in a table 6."), 
                             to_row = 4, 
                             to_col = 2)

table_print$footnotes<-NULL # remove column from final table

```


```{r T2b}
# Don't Edit This:
cnt_chapt_content<-auto_counter(cnt_chapt_content)
cnt_tables<-cnt_tables+1

# Systematically save your plot with this simple function
table_list<-save_tables(table_raw = table_raw, 
                        table_print = table_print, 
                        table_list = table_list, 
                        header = header,
                        footnote = footnote,
                        filename0 = filename0, 
                        cnt_chapt_content = cnt_chapt_content, 
                        cnt = cnt_tables#, 
                        # path = dir_out_tables
                        )
```


```{r T2c, fig.cap=ifelse(indesign_flowin %in% TRUE, "", table_list[[length(table_list)]]$caption)}

# Print or Don't Print Table in Text
# You don't want to print this in the document if this text will be flowed into InDesign. 
# However, sometimes its nice to see everything all together, so this variable is something you might like to toggle on and off. Hense, FALSE = print here, TRUE = don't print here, just make the .pdf (coded above)
if (indesign_flowin %in% FALSE) {
  table_print %>%
          format_cells(rows = 0, # make column names
                       cols = 1:ncol(table_print), # for all columns
                       fonttype = "bold") %>% # bold
          knitr::kable(row.names = FALSE, booktabs = TRUE) #print table in text
}
```

